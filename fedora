#!/usr/bin/env bash

#   
#   ███████╗███████╗██████╗  ██████╗ ██████╗  █████╗    
#   ██╔════╝██╔════╝██╔══██╗██╔═══██╗██╔══██╗██╔══██╗  
#   █████╗  █████╗  ██║  ██║██║   ██║██████╔╝███████║ 
#   ██╔══╝  ██╔══╝  ██║  ██║██║   ██║██╔══██╗██╔══██║   
#   ██║     ███████╗██████╔╝╚██████╔╝██║  ██║██║  ██║ 
#   ╚═╝     ╚══════╝╚═════╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝
#                                                                                                                 

cd "$(dirname "${0}")"

ask(){
	echo "1 : Upgrade"
	echo "2 : Install Packages and GNOME Config"
	echo -n "> "
	read selection
	case $selection in

		1 )
			upgrade_packages
			;;

		2 )
			install_base_packages
            install_gnome
			;;

		*) echo "Invalid input"
		    ;;
	esac
}

upgrade_packages(){
	echo "==> Upgrading Packages and OS"
    # remove unwanted packages and groups
    sudo dnf -y group remove LibreOffice
     
	# package update
	sudo dnf -y upgrade

	# extra repositories
	sudo dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
	sudo dnf -y install https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
	
    reboot
}

install_base_packages(){
	echo "==> Installing Packages and Configurations"
    # laptop power
	sudo dnf -y install tlp

    # terminal programs
	sudo dnf -y install bat exa fd-find fzf ripgrep stow tldr

    # allow wheel to use doas and persist password for 5 minutes
    sudo dnf -y install doas
    sudo sed -i "s/permit :wheel/permit persist :wheel/g" /etc/doas.conf
    
    # image formats
    sudo dnf -y install webp-pixbuf-loader

    # zsh
    sudo dnf -y install zsh zsh-autosuggestions zsh-syntax-highlighting starship
	
    # neovim with plugin manager
    sudo dnf -y install neovim
    sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
	nvim --headless +PlugInstall +qall

    # applications
    sudo flatpak install -y flathub com.spotify.Client
    sudo flatpak install -y flathub com.vscodium.codium
    sudo flatpak install -y flathub com.valvesoftware.Steam

	# gen ssh key
	if [[ ! -f $HOME/.ssh/id_ed25519 ]]; then
	    ssh-keygen -t ed25519 -C "jeff.windsor@gmail.com"
	    xdg-open https://github.com/settings/keys/
	fi

	# git repositories
	mkdir -p ${HOME}/src/github.com/
	mkdir -p ${HOME}/src/gitlab.com/
	git clone git@github.com:jeffwindsor/dotfiles $HOME/.dotfiles
	git clone git@github.com:jeffwindsor/installs $HOME/.installs
	git clone git@github.com:jeffwindsor/startpage $HOME/src/github.com/jeffwindsor/startpage

	# set zsh as default shell
	sudo dnf -y install util-linux-user
	chsh -s "$(which zsh)"

	# add appropriate folders to local from MEGA 
	#  if not added to one of the standard folder, add it to gnome search (such as books from mega) : Settings > Search > Search Locations > Other
	xdg-open https://mega.nz/sync/ &

    # terminal color schemes
    xdg-open https://mayccoll.github.io/Gogh/ &
    # favorites: 12 13 06 59 72 136 141 195 201
}

install_gnome(){
	echo "==> Gnome"
    sudo dnf -y install gnome-tweaks
    sudo dnf -y install gnome-shell-extension-pop-shell
	# remove unwanted defaults
	# sudo dnf -y remove gnome-shell-extension-apps-menu
    
    source ./gnome
}

ask
