#!/usr/bin/env bash

#   
#   ███████╗███████╗██████╗  ██████╗ ██████╗  █████╗    
#   ██╔════╝██╔════╝██╔══██╗██╔═══██╗██╔══██╗██╔══██╗  
#   █████╗  █████╗  ██║  ██║██║   ██║██████╔╝███████║ 
#   ██╔══╝  ██╔══╝  ██║  ██║██║   ██║██╔══██╗██╔══██║   
#   ██║     ███████╗██████╔╝╚██████╔╝██║  ██║██║  ██║ 
#   ╚═╝     ╚══════╝╚═════╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝
#                                                                                                                 

cd "$(dirname "${0}")"

ask(){
	echo "1 : Upgrade Packages and OS"
	echo "2 : Gnome Packages and Config"
    echo "3 : Gnome Config Only"
	echo -n "> "
	read selection
	case $selection in

		1 )
			upgrade_packages
			;;

		2 )
			install_base_packages
            install_gnome
            config_gnome
			;;

		3 )
            config_gnome
			;;

		*) echo "Invalid input"
		    ;;
	esac
}

upgrade_packages(){
	echo "==> Upgrading Packages and OS"
    # remove unwanted packages and groups
    sudo dnf -y group remove LibreOffice
    
	# package update
	sudo dnf -y upgrade

	# extra repositories
	sudo dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
	sudo dnf -y install https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
	
    reboot
}

install_base_packages(){
	echo "==> Installing Packages and Configurations"
    # laptop power
	sudo dnf -y install tlp

    # terminal programs
	sudo dnf -y install bat exa fd-find fzf ripgrep stow tldr 
    
    # image formats
    sudo dnf -y install webp-pixbuf-loader

    # zsh
    sudo dnf -y install zsh zsh-autosuggestions zsh-syntax-highlighting starship
	
    # neovim with plugin manager
    sudo dnf -y install neovim
	curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
	nvim --headless +PlugInstall +qall

    # applications
    sudo flatpak install -y flathub com.spotify.Client
    sudo flatpak install -y flathub com.vscodium.codium
    sudo flatpak install -y flathub com.valvesoftware.Steam

	# gen ssh key
	if [[ ! -f $HOME/.ssh/id_ed25519 ]]; then
	    ssh-keygen -t ed25519 -C "jeff.windsor@gmail.com"
	    xdg-open https://github.com/settings/keys/
	fi

	# git repositories
	mkdir -p ${HOME}/src/github.com/
	mkdir -p ${HOME}/src/gitlab.com/
	git clone git@github.com:jeffwindsor/dotfiles $HOME/.dotfiles
	git clone git@github.com:jeffwindsor/installs $HOME/.installs
	git clone git@github.com:jeffwindsor/startpage $HOME/src/github.com/jeffwindsor/startpage

	# set zsh as default shell
	sudo dnf -y install util-linux-user
	chsh -s "$(which zsh)"

	# add appropriate folders to local from MEGA 
	#  if not added to one of the standard folder, add it to gnome search (such as books from mega) : Settings > Search > Search Locations > Other
	xdg-open https://mega.nz/sync/ &

    # terminal color schemes
    xdg-open https://mayccoll.github.io/Gogh/ &
    # favorites: 12 13 06 59 72 136 141 195 201
}

install_gnome(){
	echo "==> Gnome"
    sudo dnf -y install gnome-tweaks

    # extensions
    sudo dnf -y install gnome-shell-extension-pop-shell
	xdg-open https://extensions.gnome.org/extension/1401/bluetooth-quick-connect/ &
	xdg-open https://extensions.gnome.org/extension/21/workspace-indicator/ &
	xdg-open https://extensions.gnome.org/extension/3193/blur-my-shell/ &
	xdg-open https://extensions.gnome.org/extension/3843/just-perfection/ &
	xdg-open https://extensions.gnome.org/extension/3956/gnome-fuzzy-app-search/ &
	xdg-open https://extensions.gnome.org/extension/4472/spotify-tray/ &
	xdg-open https://extensions.gnome.org/extension/517/caffeine/ &
	xdg-open https://extensions.gnome.org/extension/600/launch-new-instance/ &
	xdg-open https://extensions.gnome.org/extension/615/appindicator-support/ &
	xdg-open https://extensions.gnome.org/extension/906/sound-output-device-chooser/ &

	# remove unwanted defaults
	# sudo dnf -y remove gnome-shell-extension-apps-menu
}

config_gnome(){
    # interface preferences
    dconf write "/org/gnome/desktop/interface/clock-format" "'12h'"
    dconf write "/org/gnome/desktop/interface/clock-show-weekday" "true"
    dconf write "/org/gnome/desktop/interface/gtk-theme" "'Adwaita-dark'"
    dconf write "/org/gnome/desktop/interface/text-scaling-factor" "1.25"
    dconf write "/org/gnome/desktop/peripherals/touchpad/click-method" "'fingers'"
    dconf write "/org/gnome/desktop/peripherals/touchpad/natural-scroll" "true"
    dconf write "/org/gnome/desktop/peripherals/touchpad/speed" "0.4"
    dconf write "/org/gnome/desktop/peripherals/touchpad/two-finger-scrolling-enabled" "true"
    dconf write "/org/gnome/desktop/wm/preferences/button-layout" "'close:appmenu'"
    dconf write "/org/gnome/desktop/wm/preferences/num-workspaces" "10"
    dconf write "/org/gnome/mutter/dynamic-workspaces" "false"
    dconf write "/org/gtk/settings/file-chooser/clock-format" "'12h'"
    dconf write "/org/gnome/desktop/datetime/automatic-timezone" "true"
    dconf write "/org/gnome/shell/weather/locations" "@av []"
    dconf write "/org/gnome/desktop/interface/locate-pointer" "true"
    dconf write "/org/gnome/desktop/calendar/show-weekdate" "true"
    dconf write "/org/gnome/mutter/workspaces-only-on-primary" "true"

    # keyboard bindings : unset
    dconf write "/org/gnome/desktop/wm/keybindings/begin-move" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/begin-resize" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/close" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/cycle-group" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/cycle-group-backward" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/cycle-windows" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/cycle-windows-backward" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-last" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-input-source" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-input-source-backward" "@as []"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-last" "@as []"
    dconf write "/org/gnome/mutter/keybindings/toggle-tiled-left" "@as []"
    dconf write "/org/gnome/mutter/keybindings/toggle-tiled-right" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/area-screenshot-clip" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/logout" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/magnifier" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/screencast" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/screenreader" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/screenshot-clip" "@as []"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/window-screenshot-clip" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/activate-launcher" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-monitor-down" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-monitor-left" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-monitor-right" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-monitor-up" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-workspace-down" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/pop-workspace-up" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/toggle-floating" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/toggle-stacking" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/toggle-stacking-global" "@as []"
    dconf write "/org/gnome/shell/extensions/pop-shell/toggle-tiling" "@as []"
    dconf write "/org/gnome/shell/keybindings/focus-active-notification" "@as []"

    # keyboard bindings : set
    dconf write "/org/gnome/desktop/wm/keybindings/close" "['<Super>q']"
    dconf write "/org/gnome/desktop/wm/keybindings/minimize" "['<Super>w']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-1" "['<Primary><Super>1']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-10" "['<Primary><Super>0']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-2" "['<Primary><Super>2']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-3" "['<Primary><Super>3']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-4" "['<Primary><Super>4']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-5" "['<Primary><Super>5']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-6" "['<Primary><Super>6']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-7" "['<Primary><Super>7']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-8" "['<Primary><Super>8']"
    dconf write "/org/gnome/desktop/wm/keybindings/move-to-workspace-9" "['<Primary><Super>9']"
    dconf write "/org/gnome/desktop/wm/keybindings/panel-run-dialog" "['<Primary>space']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-1" "['<Super>1']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-10" "['<Super>0']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-2" "['<Super>2']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-3" "['<Super>3']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-4" "['<Super>4']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-5" "['<Super>5']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-6" "['<Super>6']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-7" "['<Super>7']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-8" "['<Super>8']"
    dconf write "/org/gnome/desktop/wm/keybindings/switch-to-workspace-9" "['<Super>9']"
    dconf write "/org/gnome/desktop/wm/keybindings/toggle-fullscreen" "['<Primary><Super>m']"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/area-screenshot" "['<Primary><Super>BackSpace']"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/control-center" "['<Super>comma']"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/next" "['AudioForward']"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/previous" "['AudioRewind']"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/window-screenshot" "['<Super>BackSpace']"
    dconf write "/org/gnome/shell/keybindings/toggle-message-tray" "['<Super>n']"

    # keyboard bindings : custom
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings" "['/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/', '/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/']"

    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/binding" "'<Primary>Delete'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/command" "'shutdown -r now'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom0/name" "'Reboot'"

    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/binding" "'<Primary><Super>Delete'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/command" "'shutdown -h now'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom1/name" "'Power-Off'"

    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/binding" "'<Primary><Super>Escape'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/command" "'gnome-session-quit --logout --no-prompt'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom2/name" "'Logout'"

    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/binding" "'<Super>t'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/command" "'gnome-terminal'"
    dconf write "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/custom3/name" "'Terminal'"
}

ask
