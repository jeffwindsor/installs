#!/usr/bin/env bash
cd "$(dirname "${0}")"
#   
#    /$$$$$$$$              /$$                                 
#   | $$_____/             | $$                             
#   | $$     /$$$$$$   /$$$$$$$  /$$$$$$   /$$$$$$  /$$$$$$ 
#   | $$$$$ /$$__  $$ /$$__  $$ /$$__  $$ /$$__  $$|____  $$
#   | $$__/| $$$$$$$$| $$  | $$| $$  \ $$| $$  \__/ /$$$$$$$
#   | $$   | $$_____/| $$  | $$| $$  | $$| $$      /$$__  $$
#   | $$   |  $$$$$$$|  $$$$$$$|  $$$$$$/| $$     |  $$$$$$$
#   |__/    \_______/ \_______/ \______/ |__/      \_______/
#                                                           

ask(){
	echo "1 : Upgrade"
	echo "2 : Install Packages"
	echo -n "> "
	read selection
	case $selection in

		1 )
            add_repositories
			upgrade_packages
            reboot
			;;

		2 )
			install_base_packages
            source ./shared/sshkeys
            source ./shared/gitclones
            source ./shared/gnome
            source ./shared/flathub
			;;

		*) echo "Invalid input"
		    ;;
	esac
}

upgrade_packages(){
	# package update
	sudo dnf -y upgrade
}

add_repositories(){
	# extra repositories
	sudo dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
	sudo dnf -y install https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
}

install_base_packages(){
    # remove unwanted packages and groups
    sudo dnf -y group remove LibreOffice
     
    # laptop power
	sudo dnf -y install tlp

    # terminal programs
	sudo dnf -y install bat exa fd-find fzf ripgrep stow tldr

    # image formats
    sudo dnf -y install webp-pixbuf-loader

    # zsh
    sudo dnf -y install zsh zsh-autosuggestions zsh-syntax-highlighting starship
	
    # neovim with plugin manager
    sudo dnf -y install neovim
    sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
	nvim --headless +PlugInstall +qall

	# Gnome
    sudo dnf -y install gnome-tweaks
    
    # set zsh as default shell - logout to get shell change"
    sudo lchsh -s $(which zsh)
}

ask
